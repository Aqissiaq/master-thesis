\section{Computational Results}\label{sec:results}

Having implemented several patch theories we can have a look at what they actually do.
In this section we do exactly that, considering some concrete examples of repositories,
patches and merges for the three theories.

[NOTES]
\begin{itemize}
\item rewrite?
\item trans/hcomp problems
\item mention Brunerie number (and the smaller Brunerie nr.)
\end{itemize}

\subsection{Elementary Patch Computations}

First, consider the elementary patch theory implemented in \autoref{sec/elementary-hpt}.
Recall that this theory has one type of repositories -- the integers -- and one patch
-- \texttt{add1}.

\begin{code}[hide]%
\>[0]\AgdaSymbol{\{-\#}\AgdaSpace{}%
\AgdaKeyword{OPTIONS}\AgdaSpace{}%
\AgdaPragma{--cubical}\AgdaSpace{}%
\AgdaPragma{--allow-unsolved-metas}\AgdaSpace{}%
\AgdaPragma{--rewriting}\AgdaSpace{}%
\AgdaSymbol{\#-\}}\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{results}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Cubical.Data.Nat}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Cubical.Data.Sigma}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{hiding}\AgdaSymbol{(}\AgdaPrimitive{comp}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Cubical.Data.Int}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{elementary-hpt}\<%
\end{code}

By the usual path operations we obtain some more patches: the "do nothing"-patch \texttt{noop},
the inverse \texttt{sub1} and compositions like \texttt{add2}.
\begin{code}%
%
\>[2]\AgdaFunction{noop}\AgdaSpace{}%
\AgdaFunction{sub1}\AgdaSpace{}%
\AgdaFunction{add2}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Patch}\<%
\\
%
\>[2]\AgdaFunction{noop}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\\
%
\>[2]\AgdaFunction{sub1}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaInductiveConstructor{add1}\<%
\\
%
\>[2]\AgdaFunction{add2}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{add1}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∙}}\AgdaSpace{}%
\AgdaInductiveConstructor{add1}\<%
\end{code}

All of these suggestively named patches behave as one might expect:
\begin{code}%
%
\>[2]\AgdaFunction{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{apply}\AgdaSpace{}%
\AgdaFunction{noop}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≡}}\AgdaSpace{}%
\AgdaNumber{1}\<%
\\
%
\>[2]\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{apply}\AgdaSpace{}%
\AgdaInductiveConstructor{add1}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≡}}\AgdaSpace{}%
\AgdaNumber{2}\<%
\\
%
\>[2]\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{apply}\AgdaSpace{}%
\AgdaFunction{sub1}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≡}}\AgdaSpace{}%
\AgdaNumber{0}\<%
\\
%
\>[2]\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{apply}\AgdaSpace{}%
\AgdaFunction{add2}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≡}}\AgdaSpace{}%
\AgdaNumber{3}\<%
\\
%
\>[2]\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{apply}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{add1}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∙}}\AgdaSpace{}%
\AgdaFunction{sub1}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≡}}\AgdaSpace{}%
\AgdaNumber{1}\<%
\\
%
\>[2]\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\end{code}

We can generalize further and create patches to add or subtract any integer,
and these also compute as expected.
\begin{code}%
%
\>[2]\AgdaComment{--\ maybe\ hide\ this\ definition}\<%
\\
%
\>[2]\AgdaFunction{addN}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℤ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Patch}\<%
\\
%
\>[2]\AgdaFunction{addN}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{pos}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{noop}\<%
\\
%
\>[2]\AgdaFunction{addN}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{pos}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{add1}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∙}}\AgdaSpace{}%
\AgdaFunction{addN}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{pos}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{addN}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{negsuc}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{sub1}\<%
\\
%
\>[2]\AgdaFunction{addN}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{negsuc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{sub1}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∙}}\AgdaSpace{}%
\AgdaFunction{addN}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{negsuc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{apply}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{addN}\AgdaSpace{}%
\AgdaNumber{22}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaNumber{20}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≡}}\AgdaSpace{}%
\AgdaNumber{42}\<%
\\
%
\>[2]\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{apply}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{addN}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{-}}\AgdaSpace{}%
\AgdaNumber{22}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaNumber{42}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≡}}\AgdaSpace{}%
\AgdaNumber{20}\<%
\\
%
\>[2]\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\end{code}

Clearly, this patch theory is a fully functioning calculator (for integer addition and subtraction),
but the detour through algebraic topology takes a computational toll.
The following proof typechecks, but it takes about 2 minutes.
\begin{code}%
%
\>[2]\AgdaFunction{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{apply}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{addN}\AgdaSpace{}%
\AgdaNumber{1000}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≡}}\AgdaSpace{}%
\AgdaNumber{1000}\<%
\\
%
\>[2]\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\end{code}

\begin{figure}
\begin{centering}
\begin{tikzcd}
  & n \arrow[ld, "p"'] \arrow[rd, "q"] &\\
  x \arrow[rd, "p'"'] && y \arrow[ld, "q'"] \\
  & z&
\end{tikzcd}
\caption{\texttt{merger}}
\label{fig:elementary-merger}
\end{centering}
\end{figure}

Finally, we look at \texttt{merge}. The function \texttt{merger} neatly computes the result of
merging patches $p$ and $q$ from the original repository $n$ as shown in
\autoref{fig:elementary-merger}.
\begin{code}%
%
\>[2]\AgdaFunction{merger}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℤ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Patch}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Patch}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{ℤ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{ℤ}\<%
\\
%
\>[2]\AgdaFunction{merger}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{let}%
\>[145I]\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{apply}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{n}\<%
\\
\>[.][@{}l@{}]\<[145I]%
\>[21]\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{apply}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaBound{n}\<%
\\
%
\>[21]\AgdaSymbol{(}\AgdaBound{p'}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{q'}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{merge}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaKeyword{in}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{apply}\AgdaSpace{}%
\AgdaBound{p'}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{apply}\AgdaSpace{}%
\AgdaBound{q'}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\<%
\end{code}

Applying \texttt{merger} to a few test cases, it too behaves as expected.
The resulting two integers are always equal, which is exactly what we want merge to do.
Of course this is a consequence of the general case proven by \texttt{reconcile} in
\autoref{sec/elementary-hpt}, but it is good to see it in practice.
\begin{code}%
%
\>[2]\AgdaFunction{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{merger}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSpace{}%
\AgdaFunction{noop}\AgdaSpace{}%
\AgdaFunction{sub1}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≡}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{-1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaNumber{-1}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{merger}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{addN}\AgdaSpace{}%
\AgdaNumber{5}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{addN}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{-3}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≡}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\end{code}

\subsection{Patch Computations with Laws}

Next we examine the patch theory with laws and its patch optimizer from \autoref{sec/laws-noTrunc-noIndep}.
In this theory the repository is a fixed-length vector of strings, and the patches permute the string
at a given index.
\begin{code}[hide]%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Cubical.Foundations.Prelude}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{hiding}\AgdaSymbol{(}\AgdaPrimitive{comp}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Cubical.Foundations.GroupoidLaws}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Cubical.Data.Vec}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Fin.Base}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Nat.Properties.Core}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Relation.Nullary.Decidable.Core}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Agda.Builtin.Unit}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}∘\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaBound{C}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{C}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{C}\<%
\\
\>[0]\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∘}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{g}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{laws-hpt-noTrunc-noIndep}\<%
\end{code}

For concrete examples, consider the starting repository and patches:
\begin{code}%
%
\>[2]\AgdaFunction{repo}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{repoType}\<%
\\
%
\>[2]\AgdaFunction{repo}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaString{"hello"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaString{"world"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{nop}\AgdaSpace{}%
\AgdaFunction{swap}\AgdaSpace{}%
\AgdaFunction{swap'}\AgdaSpace{}%
\AgdaFunction{comp}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Patch}\<%
\\
%
\>[2]\AgdaFunction{nop}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaString{"nop"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{↔}}\AgdaSpace{}%
\AgdaString{"nop"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{\#}}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{swap}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaString{"hello"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{↔}}\AgdaSpace{}%
\AgdaString{"greetings"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{\#}}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{swap'}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaString{"world"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{↔}}\AgdaSpace{}%
\AgdaString{"earthlings"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{\#}}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{comp}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{swap}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∙}}\AgdaSpace{}%
\AgdaFunction{swap'}\<%
\end{code}

When applying these patches, we encounter the current limits of Cubical Agda.
In particular, \texttt{Vec String size} is a dependent family so \texttt{transp} and
\texttt{hcomp} do not compute on it. In the simple case of applying just one patch the issue
is resolved by \texttt{transportRefl : (x : A) → transport refl x ≡ x}, giving the expected result.
\begin{code}%
%
\>[2]\AgdaFunction{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{apply}\AgdaSpace{}%
\AgdaFunction{nop}\AgdaSpace{}%
\AgdaFunction{repo}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≡}}\AgdaSpace{}%
\AgdaFunction{repo}\<%
\\
%
\>[2]\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{transportRefl}\AgdaSpace{}%
\AgdaFunction{repo}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{apply}\AgdaSpace{}%
\AgdaFunction{swap}\AgdaSpace{}%
\AgdaFunction{repo}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≡}}\AgdaSpace{}%
\AgdaString{"greetings"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaString{"world"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\<%
\\
%
\>[2]\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{transportRefl}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\end{code}

In the case of composition it gets more difficult. The following cannot be proven by
\texttt{transportRefl}, since the computation gets stuck on the composition.
\begin{code}%
%
\>[2]\AgdaFunction{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{apply}\AgdaSpace{}%
\AgdaFunction{comp}\AgdaSpace{}%
\AgdaFunction{repo}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≡}}\AgdaSpace{}%
\AgdaString{"greetings"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaString{"earthlings"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\<%
\\
%
\>[2]\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaHole{\{!!\}}\<%
\end{code}

Of course it is possible to compute the result by hand. Here we have some more information
about the patches being composed, and are able to eliminate the composition before applying the patch.
\begin{code}%
%
\>[2]\AgdaFunction{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{apply}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{nop}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∙}}\AgdaSpace{}%
\AgdaFunction{swap}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{repo}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≡}}%
\>[33]\AgdaString{"greetings"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaString{"world"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\<%
\\
%
\>[2]\AgdaSymbol{\AgdaUnderscore{}}%
\>[318I]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{apply}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{nop}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∙}}\AgdaSpace{}%
\AgdaFunction{swap}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{repo}\<%
\\
\>[.][@{}l@{}]\<[318I]%
\>[4]\AgdaOperator{\AgdaFunction{≡⟨}}\AgdaSpace{}%
\AgdaFunction{cong}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{apply}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∙}}\AgdaSpace{}%
\AgdaFunction{swap}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{repo}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{R.noop}\AgdaSpace{}%
\AgdaString{"nop"}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{\#}}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaFunction{apply}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∙}}\AgdaSpace{}%
\AgdaFunction{swap}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{repo}\<%
\\
%
\>[4]\AgdaOperator{\AgdaFunction{≡⟨}}\AgdaSpace{}%
\AgdaFunction{cong}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{apply}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaFunction{repo}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lUnit}\AgdaSpace{}%
\AgdaFunction{swap}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaFunction{apply}\AgdaSpace{}%
\AgdaFunction{swap}\AgdaSpace{}%
\AgdaFunction{repo}\<%
\\
%
\>[4]\AgdaOperator{\AgdaFunction{≡⟨}}\AgdaSpace{}%
\AgdaFunction{transportRefl}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaString{"greetings"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaString{"world"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∎}}\<%
\end{code}

Applying the patches in order also produces the expected result.
[THIS SHOULD BE EQUIVALENT TO COMPOSITION, BUT IT'S REALLY HAIRY]
\begin{code}%
%
\>[2]\AgdaFunction{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{apply}\AgdaSpace{}%
\AgdaFunction{swap}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{apply}\AgdaSpace{}%
\AgdaFunction{swap'}\AgdaSpace{}%
\AgdaFunction{repo}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≡}}\AgdaSpace{}%
\AgdaString{"greetings"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaString{"earthlings"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\<%
\\
%
\>[2]\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{apply}\AgdaSpace{}%
\AgdaFunction{swap}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{transportRefl}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaString{"hello"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaString{"earthlings"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∙}}\AgdaSpace{}%
\AgdaFunction{transportRefl}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\end{code}

In addition to the patches themselves this theory includes an optimizer
making use of the patch laws. In our implementation these optimized patches come equipped
with a proof that they are equal to the original patch, so testing the results should not reveal
anything new -- nevertheless it is interesting to note just how slow these computations are.

All three exhaust the heap, taking on the order of 10s of minutes to do so, \texttt{swapOpt} is
particularly notable since \texttt{optimize} does not actually do anything.
The strings in \texttt{swap} are not equal, and so the patch should be kept as it is.
\begin{code}%
%
\>[2]\AgdaFunction{nopOpt}\AgdaSpace{}%
\AgdaFunction{swapOpt}\AgdaSpace{}%
\AgdaFunction{compOpt}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Patch}\<%
\\
%
\>[2]\AgdaFunction{nopOpt}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{optimize}\AgdaSpace{}%
\AgdaFunction{nop}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{swapOpt}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{optimize}\AgdaSpace{}%
\AgdaFunction{swap}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{compOpt}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{optimize}\AgdaSpace{}%
\AgdaFunction{comp}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaComment{--\ \AgdaUnderscore{}\ :\ apply\ swapOpt\ repo\ ≡\ "greetings"\ ∷\ "world"\ ∷\ []}\<%
\\
%
\>[2]\AgdaComment{--\ \AgdaUnderscore{}\ =\ transportRefl\ "greetings"\ ∷\ "world"\ ∷\ []}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaComment{--\ \AgdaUnderscore{}\ :\ apply\ nopOpt\ repo\ ≡\ repo}\<%
\\
%
\>[2]\AgdaComment{--\ \AgdaUnderscore{}\ =\ transportRefl\ repo}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaComment{--\ \AgdaUnderscore{}\ :\ apply\ compOpt\ repo\ ≡\ "greetings"\ ∷\ "earthlings"\ ∷\ []}\<%
\\
%
\>[2]\AgdaComment{--\ \AgdaUnderscore{}\ =\ transportRefl\ \AgdaUnderscore{}}\<%
\end{code}

\subsection{Richer Contexts}

\begin{code}[hide]%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{richer}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{richer-no-laws}\AgdaSpace{}%
\AgdaKeyword{public}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{S}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{singl}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
%
\>[2]\AgdaFunction{S}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\end{code}
Finally, we consider the patch theory with richer contexts from \autoref{sec:richer}.
For this theory we have implemented two interpretations, we will look at them in turn
followed by merging. For the purpose of testing, define a few simple patches:
\begin{code}%
%
\>[2]\AgdaFunction{addPatch}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaInductiveConstructor{doc}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≡}}\AgdaSpace{}%
\AgdaInductiveConstructor{doc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ADD}}\AgdaSpace{}%
\AgdaString{"hello"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{addPatch}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{addP}\AgdaSpace{}%
\AgdaString{"hello"}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{rmPatch}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaInductiveConstructor{doc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ADD}}\AgdaSpace{}%
\AgdaString{"hello"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≡}}\AgdaSpace{}%
\AgdaInductiveConstructor{doc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{RM}}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ADD}}\AgdaSpace{}%
\AgdaString{"hello"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{))}\<%
\\
%
\>[2]\AgdaFunction{rmPatch}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{rmP}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ADD}}\AgdaSpace{}%
\AgdaString{"hello"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\<%
\end{code}

\subsubsection{Vector Interpretation}

The first interpretation sends each \texttt{doc h} to a singleton type of the vector determined
by replay. For the simplest patches this works as expected with \texttt{transportRefl}.
(Here \texttt{S} denotes the inclusion into the singleton type.)

\begin{code}%
%
\>[2]\AgdaFunction{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{apply}\AgdaSpace{}%
\AgdaFunction{addPatch}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{S}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≡}}\AgdaSpace{}%
\AgdaFunction{S}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaString{"hello"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{transportRefl}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{apply}\AgdaSpace{}%
\AgdaFunction{rmPatch}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{S}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaString{"hello"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≡}}\AgdaSpace{}%
\AgdaFunction{S}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\<%
\\
%
\>[2]\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{transportRefl}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{apply}\AgdaSpace{}%
\AgdaFunction{rmPatch}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{apply}\AgdaSpace{}%
\AgdaFunction{addPatch}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{S}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≡}}\AgdaSpace{}%
\AgdaFunction{S}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\<%
\\
%
\>[2]\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[507I]\AgdaFunction{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{apply}\AgdaSpace{}%
\AgdaFunction{rmPatch}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{transportRefl}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaString{"hello"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSymbol{))}\<%
\\
\>[.][@{}l@{}]\<[507I]%
\>[6]\AgdaOperator{\AgdaFunction{∙}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{transportRefl}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSymbol{))}\<%
\end{code}

Again, direct composition of patches runs in to the current limits of Cubical Agda.
Because \texttt{hcomp} does not reduce in singletons (which is a $\Sigma$-type),
we get stuck trying to compute the (enormous) composition term.
\begin{code}%
%
\>[2]\AgdaComment{--\ \AgdaUnderscore{}\ :\ apply\ (addPatch\ ∙\ rmPatch)\ (S\ [])\ ≡\ S\ []}\<%
\\
%
\>[2]\AgdaComment{--\ \AgdaUnderscore{}\ =\ apply\ (addPatch\ ∙\ rmPatch)\ (S\ (replay\ []))}\<%
\\
%
\>[2]\AgdaComment{--\ \ \ ≡⟨\ transportRefl\ \AgdaUnderscore{}\ ⟩\ \AgdaUnderscore{}}\<%
\\
%
\>[2]\AgdaComment{--\ \ \ ≡⟨\ \{!!\}\ ⟩\ S\ (replay\ (RM\ zero\ ::\ (ADD\ "hello"\ AT\ zero\ ::\ [])))\ ∎}\<%
\end{code}

\subsubsection{History Interpretation}

The second interpretation eludes replaying the patches, instead sending \texttt{doc h}
to the singleton history \texttt{h}. In a familiar turn of events the simple patches give
expected results, but composition poses a problem. (Note that \texttt{[]} in these examples
is the empty \emph{history} rather than the empty vector.)

\begin{code}%
%
\>[2]\AgdaFunction{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{applyH}\AgdaSpace{}%
\AgdaFunction{addPatch}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{S}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≡}}\AgdaSpace{}%
\AgdaFunction{S}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ADD}}\AgdaSpace{}%
\AgdaString{"hello"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{transportRefl}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{\AgdaUnderscore{}}%
\>[536I]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{applyH}\AgdaSpace{}%
\AgdaFunction{rmPatch}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{S}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ADD}}\AgdaSpace{}%
\AgdaString{"hello"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{))}\<%
\\
\>[.][@{}l@{}]\<[536I]%
\>[4]\AgdaOperator{\AgdaFunction{≡}}\AgdaSpace{}%
\AgdaFunction{S}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{RM}}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ADD}}\AgdaSpace{}%
\AgdaString{"hello"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{))}\<%
\\
%
\>[2]\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{transportRefl}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\end{code}

\subsubsection{Merge}
\begin{code}[hide]%
%
\>[2]\AgdaFunction{undo}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{n}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{History}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{History}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaBound{n}\<%
\\
%
\>[2]\AgdaFunction{undo}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\<%
\\
%
\>[2]\AgdaFunction{undo}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ADD}}\AgdaSpace{}%
\AgdaBound{s}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaBound{h}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{RM}}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{+++}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{undo}\AgdaSpace{}%
\AgdaBound{h}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{undo}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{RM}}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaBound{h}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ADD}}\AgdaSpace{}%
\AgdaString{"uh\ oh"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{+++}}\AgdaSpace{}%
\AgdaFunction{undo}\AgdaSpace{}%
\AgdaBound{h}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaKeyword{postulate}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaPostulate{undo-inverse}\AgdaSpace{}%
\AgdaSymbol{:}%
\>[603I]\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{n}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{h}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{History}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\<%
\\
\>[.][@{}l@{}]\<[603I]%
\>[19]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{+++}}\AgdaSpace{}%
\AgdaFunction{undo}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≡}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\<%
\end{code}

In \autoref{sec:richer} we reduced the task of merging patches to merging histories.
As a concrete example, consider a merger of histories which keeps one history if the other is empty,
but simply undos the changes in both branches if there is a possibility of conflict.
\begin{code}%
%
\>[2]\AgdaFunction{undo-merge}\AgdaSpace{}%
\AgdaSymbol{:}%
\>[619I]\AgdaSymbol{\{}\AgdaBound{n}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\<%
\\
\>[.][@{}l@{}]\<[619I]%
\>[15]\AgdaSymbol{(}\AgdaBound{h1}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{History}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{h2}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{History}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\<%
\\
%
\>[15]\AgdaFunction{Σ[}\AgdaSpace{}%
\AgdaBound{n'}\AgdaSpace{}%
\AgdaFunction{∈}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Σ[}\AgdaSpace{}%
\AgdaBound{h'}\AgdaSpace{}%
\AgdaFunction{∈}\AgdaSpace{}%
\AgdaDatatype{History}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSpace{}%
\AgdaBound{n'}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Extension}\AgdaSpace{}%
\AgdaBound{h1}\AgdaSpace{}%
\AgdaBound{h'}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaFunction{Extension}\AgdaSpace{}%
\AgdaBound{h2}\AgdaSpace{}%
\AgdaBound{h'}\AgdaSymbol{))}\<%
\\
%
\>[2]\AgdaFunction{undo-merge}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{m}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaBound{h2}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{h2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{h2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{+++-left-id}\AgdaSpace{}%
\AgdaBound{h2}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaCatchallClause{\AgdaFunction{undo-merge}}\AgdaSpace{}%
\AgdaCatchallClause{\AgdaSymbol{\{}}\AgdaCatchallClause{\AgdaBound{n}}\AgdaCatchallClause{\AgdaSymbol{\}}}\AgdaSpace{}%
\AgdaCatchallClause{\AgdaSymbol{\{\AgdaUnderscore{}\}}}\AgdaSpace{}%
\AgdaCatchallClause{\AgdaBound{h1}}\AgdaSpace{}%
\AgdaCatchallClause{\AgdaInductiveConstructor{[]}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{h1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{h1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{+++-left-id}\AgdaSpace{}%
\AgdaBound{h1}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaCatchallClause{\AgdaFunction{undo-merge}}\AgdaSpace{}%
\AgdaCatchallClause{\AgdaSymbol{\{\AgdaUnderscore{}\}}}\AgdaSpace{}%
\AgdaCatchallClause{\AgdaSymbol{\{\AgdaUnderscore{}\}}}\AgdaSpace{}%
\AgdaCatchallClause{\AgdaBound{h1}}\AgdaSpace{}%
\AgdaCatchallClause{\AgdaBound{h2}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{undo}\AgdaSpace{}%
\AgdaBound{h1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaPostulate{undo-inverse}\AgdaSpace{}%
\AgdaBound{h1}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{undo}\AgdaSpace{}%
\AgdaBound{h2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaPostulate{undo-inverse}\AgdaSpace{}%
\AgdaBound{h2}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{merging}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaFunction{undo-merge}\AgdaSymbol{\}}\<%
\end{code}

We further define some simple patches
\begin{code}%
%
\>[2]\AgdaFunction{p1}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaInductiveConstructor{doc}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≡}}\AgdaSpace{}%
\AgdaInductiveConstructor{doc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ADD}}\AgdaSpace{}%
\AgdaString{"hello"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{p1}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{addP}\AgdaSpace{}%
\AgdaString{"hello"}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{zero}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{p2}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaInductiveConstructor{doc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ADD}}\AgdaSpace{}%
\AgdaString{"hello"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≡}}\AgdaSpace{}%
\AgdaInductiveConstructor{doc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ADD}}\AgdaSpace{}%
\AgdaString{"world"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ADD}}\AgdaSpace{}%
\AgdaString{"hello"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{))}\<%
\\
%
\>[2]\AgdaFunction{p2}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{addP}\AgdaSpace{}%
\AgdaString{"world"}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ADD}}\AgdaSpace{}%
\AgdaString{"hello"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\<%
\end{code}

and observe that the merged histories (or at least their lengths) give the expected
results by \texttt{transportRefl}. Merging \texttt{p1} with \texttt{refl} keeps \texttt{p1}:
\begin{code}%
%
\>[2]\AgdaFunction{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{merge}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaFunction{p1}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≡}}\AgdaSpace{}%
\AgdaNumber{1}\<%
\\
%
\>[2]\AgdaSymbol{\AgdaUnderscore{}}%
\>[764I]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{undo-merge}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{applyH}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{applyH}\AgdaSpace{}%
\AgdaFunction{p1}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSymbol{)))))}\<%
\\
\>[.][@{}l@{}]\<[764I]%
\>[4]\AgdaOperator{\AgdaFunction{≡⟨}}\AgdaSpace{}%
\AgdaFunction{cong}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{y}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{undo-merge}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{applyH}\AgdaSpace{}%
\AgdaFunction{p1}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSymbol{)))))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{transportRefl}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{undo-merge}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{applyH}\AgdaSpace{}%
\AgdaFunction{p1}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSymbol{)))))}\<%
\\
%
\>[4]\AgdaOperator{\AgdaFunction{≡⟨}}\AgdaSpace{}%
\AgdaFunction{cong}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{y}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{ADD}}\AgdaSpace{}%
\AgdaString{"hello"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{undo-merge}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{transportRefl}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{undo-merge}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ADD}}\AgdaSpace{}%
\AgdaString{"hello"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∎}}\<%
\end{code}

Merging two non-empty patches results int he empty patch:
\begin{code}%
%
\>[2]\AgdaFunction{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{merge}\AgdaSpace{}%
\AgdaFunction{p1}\AgdaSpace{}%
\AgdaFunction{p1}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≡}}\AgdaSpace{}%
\AgdaNumber{0}\<%
\\
%
\>[2]\AgdaSymbol{\AgdaUnderscore{}}%
\>[841I]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{undo-merge}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{applyH}\AgdaSpace{}%
\AgdaFunction{p1}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{applyH}\AgdaSpace{}%
\AgdaFunction{p1}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSymbol{)))))}\<%
\\
\>[.][@{}l@{}]\<[841I]%
\>[4]\AgdaOperator{\AgdaFunction{≡⟨}}%
\>[856I]\AgdaFunction{cong}%
\>[857I]\AgdaSymbol{\{}\AgdaArgument{y}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ADD}}\AgdaSpace{}%
\AgdaString{"hello"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)\}}\<%
\\
\>[.][@{}l@{}]\<[857I]%
\>[12]\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{undo-merge}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{applyH}\AgdaSpace{}%
\AgdaFunction{p1}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSymbol{)))))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{transportRefl}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\<%
\\
\>[.][@{}l@{}]\<[856I]%
\>[7]\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{undo-merge}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ADD}}\AgdaSpace{}%
\AgdaString{"hello"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{applyH}\AgdaSpace{}%
\AgdaFunction{p1}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSymbol{))))}\<%
\\
%
\>[4]\AgdaOperator{\AgdaFunction{≡⟨}}%
\>[892I]\AgdaFunction{cong}%
\>[893I]\AgdaSymbol{\{}\AgdaArgument{y}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ADD}}\AgdaSpace{}%
\AgdaString{"hello"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)\}}\<%
\\
\>[.][@{}l@{}]\<[893I]%
\>[12]\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{undo-merge}%
\>[36]\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ADD}}\AgdaSpace{}%
\AgdaString{"hello"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{transportRefl}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\<%
\\
\>[.][@{}l@{}]\<[892I]%
\>[7]\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{undo-merge}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ADD}}\AgdaSpace{}%
\AgdaString{"hello"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ADD}}\AgdaSpace{}%
\AgdaString{"hello"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∎}}\<%
\end{code}

Finally we note that composition does not pose a problem here, since \texttt{undo-merge}
extracts the history and does not need to compute the actual composition of patches.
\begin{code}%
%
\>[2]\AgdaFunction{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{merge}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{p1}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∙}}\AgdaSpace{}%
\AgdaFunction{p2}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≡}}\AgdaSpace{}%
\AgdaNumber{2}\<%
\\
%
\>[2]\AgdaSymbol{\AgdaUnderscore{}}%
\>[937I]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{undo-merge}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{applyH}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{p1}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∙}}\AgdaSpace{}%
\AgdaFunction{p2}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{applyH}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSymbol{)))))}\<%
\\
\>[.][@{}l@{}]\<[937I]%
\>[4]\AgdaOperator{\AgdaFunction{≡⟨}}\AgdaSpace{}%
\AgdaFunction{cong}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{y}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{undo-merge}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{applyH}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{p1}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∙}}\AgdaSpace{}%
\AgdaFunction{p2}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{transportRefl}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{undo-merge}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{applyH}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{p1}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∙}}\AgdaSpace{}%
\AgdaFunction{p2}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaOperator{\AgdaFunction{≡⟨}}\AgdaSpace{}%
\AgdaFunction{cong}%
\>[986I]\AgdaSymbol{\{}\AgdaArgument{y}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{ADD}}\AgdaSpace{}%
\AgdaString{"world"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaFunction{transport}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ADD}}\AgdaSpace{}%
\AgdaString{"hello"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaFunction{transport}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)\}}\<%
\\
\>[.][@{}l@{}]\<[986I]%
\>[12]\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{undo-merge}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{transportRefl}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{undo-merge}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ADD}}\AgdaSpace{}%
\AgdaString{"world"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaFunction{transport}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ADD}}\AgdaSpace{}%
\AgdaString{"hello"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaFunction{transport}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaOperator{\AgdaFunction{≡⟨}}\AgdaSpace{}%
\AgdaFunction{cong}%
\>[1032I]\AgdaSymbol{\{}\AgdaArgument{y}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{ADD}}\AgdaSpace{}%
\AgdaString{"hello"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{\}}\<%
\\
\>[.][@{}l@{}]\<[1032I]%
\>[12]\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{undo-merge}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ADD}}\AgdaSpace{}%
\AgdaString{"world"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{transportRefl}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaField{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{undo-merge}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ADD}}\AgdaSpace{}%
\AgdaString{"world"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ADD}}\AgdaSpace{}%
\AgdaString{"hello"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{AT}}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∎}}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{richer}\<%
\end{code}
